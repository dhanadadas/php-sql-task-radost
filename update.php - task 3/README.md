# Задание 3
Допустим у нас есть скрипт update.php, который обновляет статистику. Нам надо, чтобы он выполнялся каждые 20 секунд на сервере Linux. Как вы это сделаете ? Можно использовать cron.

## Варианты через крон
### 1. Простой крон
 т.к. крон не запускается чаще 1 минуты можно такой финт провернуть, добавив 3 задания.
 ```cron
* * * * * root /home/update.php
* * * * * root ( sleep 20 ; /home/update.php > /dev/null 2>/dev/null )
* * * * * root ( sleep 40 ; /home/update.php > /dev/null 2>/dev/null )
```
В итоге за минуту исполнится 3 раза. 

### 2. Дополнительный скрипт и крон
Можно написать простой скрипт и его вызывать в крон 1 раз.
```php
for ($i=0;$i<=2;$i++){
	exec("php /home/update.php > /dev/null 2>/dev/null &");
	sleep (20);
}
```
И добавить в крон
```cron
* * * * * root /home/script.php
```

## Другие варианты без использования cron
Иногда крон ведет себя не так, как хотелось при больших задачах. Тогда можно использовать следующие варианты:
### 1. supervisord
Использовать supervisord для контроля процесса update.php
В конец update.php и добавить его в supervisor.
```php
sleep (20);
```
supervisord замечательно выполняет свою функцию. Таким образом скрипт будет выполнятся в любом случае каждые 20 секунд, без использования крона. Для такой простой задачи может быть не самое оптимальное решение, но в реальных фоновых обработках незаменим. Особенно в многопоточных обработках с использованием очереди процессов.
Конфиг supervisor'а:
```bash
[program:update]
command=php /home/update.php learning:update --action=worker --execute=1
process_name=%(program_name)s_%(process_num)02d
numprocs=1
directory=/home/
autostart=true
autorestart=true
```

### 2. Рекурсивный вызов
Можно в конце update.php 
написать рекурсивный вызов
```php
...
sleep (20);
exec("php /home/update.php > /dev/null 2>/dev/null &");
```
После чего файл отправляется например в свободное плавание в фоне nohup.
Не самое надежное решение, но иногда применяется.

### 3. Написать daemon 
Написать daemon, который запускает скрипт каждые 20 сек. Добавить в автозагрузки.
Самый простой так:
```bash
nohup watch --interval=20 /home/update.php > /dev/null
```

# Вывод
**если задача по обновлению не тяжелая и не нужно слишком большая пунктуальность до миллисекунд, CRON может быть использован как решение.**
